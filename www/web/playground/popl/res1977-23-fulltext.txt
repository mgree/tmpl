the equivalence with problem for program loops center for research r in computing university technology abstract in his thesis proved that equivalence is decidable for program such that every instruction on at most one loop and only monadic function appear remove the restriction on function here we the problem reduces to that of showing that the which satisfy certain word tions over a of acyclic directed graphs be characterized by of arithmetic these correspond coefficients of the program presburger to loop the central construction is a finite automaton whose memory is a window of bounded size on en acyclic directed graph corresponding to a solution to such a word equation introduction in his thesis ch proved that equivalence is decidable for program flowchart such that every instruction lies on at most one loop and such that only function appear we here extend that result by removing the restriction on function our technique like is to re the problem to presburger arithmetic but our reduction is more complex than his for the crucial location as of times step is to present the a linear word function each loop is executed value of ie of each the num as a function with numerical arguments and to show that equality of two such functions is expressible as a presburger formula on their arguments our generalization replaces word functions by functions whose values are acyclic directed graphs representing computations once again equality of two such functions is repre in presburger arithmetic but the need to accommodate different orderings of the same comp steps makes the proof of this fact quite indirect we use among other things the fact that the set of of the words accepted by a finite automaton is definable in presburger arithmetic program so as to be able to build directly on work we very close to his definitions our formal language contains abc function etc test symbols t etc location symbols ll the assignment symbol and t research supported by nsf grant brackets etc each function sign f takes a fixed positive number f of arguments the absence of constants fo is not serious in are of two kinds computation tions a j l f and test tions a bc here a is the address of the instruction a program schema is a finite sequence of instructions such that the prefix of each is its position in the sequence together with two numbers which are not prefixes called the success address o and the failure address el we trust that the reader can supply the remaining syntactic details as well aa the definitions of sequence value which is o if e is reached if el is reached then two p q are equivalent s iff under each interpretation p and q either both diverge or both compute the same value am through a schema is a finite or infinite sequence of integers nl each of which is either a prefix eo or el such that for each i if ni ia not the last number in the path then if the instruction with prefix ni is a computation instruction then n if the instruction with prefix ni is a instruction ni then is a or b and is not e or el is a finite path rtl such that all the n are i l is and n the base point of the loop a path is the smallest number be put among n n our restriction k may now formally s is the class of such that the prefix of every instruction is in at most one loop notes that as equivalence of is concerned it suffices to consider with just one test symbol t since any other test symbol t can be avoided in of a new location l and a new monadic function sign f by replacing tl b c by l f tl b c note that this transformation does not remove a schema from the class under consideration we too find this reduction convenient and assume here after that it been carried out a purely syntactic characterization of is obtained aa follows a free tion is one whose universe is the set of terms con from the function and location symbols with functional application interpreted symbolically two are equivalent iff they are equivalent with respect to all free tions now given a path for a schema p such that let be the set of terms t by p during execution of n for which tt succeeds ie such that the next instruction executed after tt ab has prefix a b let be two such paths for pq respectively and call n end u consistent iff u l u is disjoint from fl ie q and u are the results of interpretations which do not on any term which is tested theorem for any two pq iff for all paths ti for p a for q such that n a if n and a are consistent then the values of n and a are either both un defined or are equal dags and blocks this section deals with the of computations by labelled acyclic directed graphs let be a set consisting of the function of our program plus the special sign u and let n map each function with recall that sign to its fz if fu a is a triple d where vd is a nonempty mapping vd e uv finite set of and for each v vertices and d d each is i a viewed as a directed edges directed from graph with possibly multiple to v is required to be acyclic we certain standard terms from graph theory a dag is trivial if it has only one vertex a source is a vertex into which no edge enters a sink is a vertex from which no edge thus the sources of a dag are ex the vertices labelled u a from vertex v to vertex w ia a sequence of edges possibly trivial ie of length o leading from v to w if there is a path from v to w then w ia reachable from v a is like a path except that the direction be observed and a dag is weakly of edges connected need not if there is a between any pair of vertices any dag can be decomposed uniquely into weakly connected components we assume some natural measure of the size of a dag the number of vertices plus the number of edges for example let the length of a dag be the length of the longest path and let the width be the the maximum number of pairwise incomparable vertices or that the size ia bounded by the product of length and width let a be a dag and let be a set of vertices such that for each vt if for some i av then for each i then the of a induced by t is the dag b such that if for some i n otherwise for a of a is a induced by some set of vertices now fix once and for all an integer o and let n an or just block for short is a triple where aa is a dag va with ia and a and oa are maps from being and such that the n to n range of is exactly a the set of sources of a ie the vertices labelled n the members of are called the inputs of a the members of the outputs thus paths are directed from the inputs to the outputs our model would be restricted if we required every output to be a sink but there would be no in requiring every sink to be an output the set of all forms a under a concatenation operation defined by each output of one block with the input of the next that is ab c where n if if and if and i j ac v if a kv b if if if j if f is a function fs fx and s is a set then if va and v were not disjoint n the tions could result in a structure is not acyclic we therefore that at least one of the blocks is copied in some canonical way before the definitions are applied thus for any blocks al there are uniquely determined blocks a such that al a and the vertex sets of the a are i disjoint also note that the fact that is the lb definitions of c and oc unambiguous with these observations it should be clear that the do indeed form a with identity it is a natural generalization of the now for any dag d and any set of vertices let dfs be the dag that results from d by just those vertices and edges that lie on paths which at members of s a i is a pair where is a dag with just one sink and a is a mapping whose whose range includes ed expressed as b i x domain every in the where is a subset of source b is of a which a block n and u we are may be and by which we mean ib let a respectively as follows and b be we define iff with an equivalence ab relation if and recursively for il ca t any two which represent the same term a are equivalent in this way number of occurrences of symbol and given a fixed finite alphabet let a in word w za a the a language if iff l a is it is a block l and for some contextfree let am be the product of a with itself even for mo since the this is defined has an identity group of strings over definitions a finite for alphabet the say that a block function is a mapping from tuples of natural numbers to blocks say that a block function h is linear if it has the form a for some fixed blocks a a and say that it ia hi er for il if n for some linear block function now let locations paths lt o and some presburger p be a program schema in there are only finitely many starting with instruction function s with f n and there each are only finitely many is a sequence of distinct loops l numbers l p and the numbers in all the ti are distinct then any finite path n specified h obtained which begins with by a number u h of p from the instruction can be and a n is the path path by inserting for each exactly ence of loop i b g i copies whose of ti at the in nu moreover this bi is unique method in mu be used to specify an infinite path n as well since for in s any such path must ultimately remain in a single loop t if u represent the finite path up to the point at which w enters l then the pair tu will serve as a tation of thus every path finite or is represented by at least one pair u the reduction to presburger arithmetic presburger arithmetic of the natural numbers presburger formula is ia the additive theory a decidable theory a a formula of this theory and a presburger is a set of of natural numbers for some fixed m which is lq is some presburger formula v clearly the presburger sets are closed under union tion and direct product ia a function f from such that a presburger nm to for is a presburger function some nm set alternatively presburger sets may be defined to be the acts of parikh a subset of nm is linear if it is for some fixed and some fixed finite set and a subset of nm is ion of linear sets or presburger if it s we shall also find characterization sets let wa a finite useful of the be the where and moreover every such pair represents exactly one path although some paths have several representations in case a nonzero is given for a loop whose is not on the indicated path now let be the of terms to the contents of the n locations of schema p after execution of the finite path n under a free interpretation then may be by an one way is simply to start with a representation of n as an of labelled vertex trees and to ii all the vertices together labelled into a single li for il n program more of course schema but for ut this would for p let be true for any in s we can do pu if the identity an infinite u if path represents u represents throughout this the dag underlying a paper we use some more a to complex denote structure lemma for any schema block function p p is a presburger proof if each function p for is presburger then where so is each p since p is linear if p and each f u is then pu is where p tp and and tz iff and for vu now if then p is a constant u func tion which is obviously presburger if then where u may be decomposed into segments for is a i path ending at the of some loop k then ph where and and for i iff il s q q now the combinatorial of the proof is to theorem main lemma for any linear block functions hk and any there is a presburger formula a such that hk is true iff k fy most of this paper is taken up with the proof of this fact the rest of this section shows how it and theorem can be used to obtain a decision procedure for equivalence this is essentially identical to construction but we repeat it here for completeness we first require presburger formulas for var conditions on paths through schema p here are the first component to be thought of as a number u kt rep a path and the last q being loop coefficients i is the condition a in initial that p from to address eo ii is the corresponding for e condition iii is the condition that rep an infinite path from the initial add iv sub ia the condition that the path by is an initial segment of that by v is the condition that and that path test instruction is finite and ends at a at which location li is tested and that the result must be o in order for path of the test to be vi is the corresponding condition for the value of the test conditions fin fin and may be e as finite hl u condition for the value of involves finitely many possibilities for the values of end h together with some equalities and possibly one inequality on loop coefficients p o and p are conjunctions p of with a finite disjunction of conditions on k and h j l now let p and q be two we assume they both have n locations otherwise imagine unused locations added to one schema to the numbers and that the formulas are available for both as well as presburger block as guaranteed by lemma and f p fq are presburger where p q are linear we first construct a presburger formula p s is true iff the value location after i p executes path is from that in l after we have j q executes path in ­ iff we also need next we need a formula the path fi corresponding with the path o recall the definitions p expressing p and qq the fact that to for p is corresponding to for q of the sets and paths then iff ie j ie ti v p ie tj p ie finally using theorem the formula expressing the equivalence we construct of p and iff v q q the decidability of yields the decidability ins presburger arithmetic of equivalence then for discussion in order to what follows consider first the simpler case in which only func tion appear and we wish to show that there is a formula such that is true iff where kl k and kb b q to obtain it would suffice by theorem to show that s text ia true is l for some con l and for this it would suffice to show that sl where l is the language accepted by some finite automaton m this we might do as follows we m with a central store s just twice as long as the longest path in one of the ai or bi in operation this store acts as a ring buffer the chain which represents input alphabet for m is holding a segment of a monadic term the al one tions two symbol of pointers for each of the blocks in the h and k for m has to positions within a two registers to enable m to remember which output from the next block of h or k should the input to be added to the current string and two counters ca cb with to enable m to recognize an invalid ordering of the input symbols procedure initialization m cap comment the blocks are to be processed order comment in reverse we want to compare output a against output y of pa pb pointer x of b to s until read no more a symbol input u if for some i if then reject then else comment there is a single path n in ai from some unique oa r la input a j i to try to s putting the position pa the path m onto head end of u at this cannot be done because for some the label on the symbol from the head of n is different from that on the th symbol before tion pa in s then pa to point to the beginning tail delete both end from pa of n in s any part and pb s now beyond the number of the input to n e if then same with a and e if s is longer any a or i than the longest then reject i end of repeat s is empty and accept end of procedure m path in else re now it should be clear that m accepts only if w for some such that then there moreover is a permutation if w of the word w which al ap q is may picture the construction construct the really just a path accepted by m we of w as follows place the symbols of the word p al a p that the ith symbol of c which results block in the product c in such is placed next to from a source of hh app that the a way vertex ith do the same for the symbols k in bl and con the symbols of both kinds in the order in which they have been placed c now to the case in which func tion need not be monadic the product of many blocks is unbounded in length but bounded in width so it would be natural to treat it like the path c in the simpler case above we could build a finite automaton with an internal store capable of holding a segment of bounded length a more kind of patternmatching essentially unification of dags would have to take the place of however a serious problem with this approach because of the ity of having long independent chains within a dag to illustrate let al be the block cor to a that corresponding to and al that corresponding to let aa and let ka al a then z kt is just however any attempt to and in parallel in the way that m above operates would require unbounded storage since the con of w as above cannot be applied to both long paths simultaneously instead we must break such blocks aa into weakly components resulting and keep track separately of the dags from these separate components this is the idea that is carried out formally below a reduction of the problem the step in the proof of the main lemma is to consider of the blocks large enough to have some in the structure of their inputs and outputs let a be a block for each let there is a path in a from to is the set of in the computation of output i for a set n let any io i note that now call a set u a for iff lemma for any block a there are numbers o effectively from a such that is proof since can take a values by the for every on at most principle n n are for each numbers x xn a such that p px x x and x let max and then the lemma is for some integer a il for if and n n ap n p u a ua pp p ua x x then x a q we use lemma to prove reduction the main lemma holds if there is a presburger formula iff l c f such that l yl m ia true m ty whenever the ci and di are blocks such that for every fixed c i for il r n u and il il s i proof as in the main lemma let ha h a k q let be the maximum of the s and n the cm of the as the block a in the statement of lemma ranges over l then and n have the properties these blocks we split in lemma for each of the problem of finding the formula of the main into for il cases q be the disjunction of all these here is to be true iff l true and a if h and is b hi and if and similarly for each oh we for i treat the k and k i of type a e such that h i ai as a single block and for each i of type b ie such that h and for some k we treat h as ail hi thus treating hi and a a i as single blocks we do the same for the bi and i where et we thus arrive at a problem of the form the c i correspond to be a list the i of those as follows i such that d where then c a j j for jl r i dj jl or r we have written h for and have set by convention to be the identity ain and pl the di are defined similarly from the moreover i di are satisfied c x jl is the conditions on the for ua y i j and any for some and ci which ia u y for some f ai j this set is al fixed j by lemma and hence fixed cj the same ment works for the i now suppose we can find a y as stated reduction then hk the corresponding iff h im in the jl j j a ir corresponding conditions on of course n e is written out as a sum jj unification on dags let a and b be dags an embedding in b is a mapping p such that of a if and then and for each and for il in case such an embedding of a in b exists b is called an instance of a now let and let c be another z dag a common embedding wrt z of a and b in c is an embedding of both a and b in c such that for each in this case a and b are said to be wrt z and c is called a common instance wrt z of a and b c is a most general common instance wr t z of a and b if every common instance wr t z of a and b is an instance of c unification theorem for dags if a and b are wrt z then there ia a most general common instance of a and b wrt z there is an effective procedure unify which given ab and z determines whether or not a and b are wrt z and if they are returns a most general size at most size common instance c b and a common of embedding u we omit the proof of this theorem it is a natural generalization of the corresponding theorem for terms in a firstorder language for some rel details see we adopt the following convention the value returned by unify either is a pair dp in case a and b are wrt z d is a most general common instance and w is a common embedding or is the word failure in case a and b are not wrt z in addition to the unification theorem we need two technical lemmas whose proofs we also omit these lemmas should be intuitively clear to readers familiar with ordinary unification equivalence lemma let a and b be with ab respectively then ab iff there is a and a most general common instance c of b wrt and a common em w such that a v restricted to either a r b s onto v b for each and i in this set u an embedding is called p of a in an embedding c such that of a onto c the next lemma states in essence that when two are to be performed the order in which they are performed is irrelevant to the final result let ab c be dags let suppose unify and unify where then for some p ba unify and unify where ba moreover p to be b extend f a the identity to be the on a identity then on v and b pa of the finite automaton we now begin the main construction we first state the properties we must eventually prove the machine has automaton lemma there is an effective procedure that yields for any blocks cl s and any as specified in the tion lemma a finite automaton m with the following properties and put alphabet for some numbers m operates where on the in il ij and ij moreover the is satisfied by numbers of the reduction ms lemma if and only if there is a word w accepted by m such that i odd i odd j i even s i even this lemma suffices for the construction y as described in the reduction lemma since of a a presburger formula for is accepted by m can be transformed into y by the restrictions ad which are also definable by a presburger formula like the construction of this construction is much from y in the proof of the reduction lemma each symbol c corresponds ij to a different independent chain through the block ci and similarly task is and any for the d and j to make this precise call p the di our for any block and q first a if ie if and have a a we define tj c r and s each of which is a set of disjoint subsets of nn as follows x for o i is the of c uc i il such that a each part is fixed ci and b any two ci are in the same part for ir r o t is the tion of u i such that any two c il are in the same part a the acts di are defined similarly the di from y and note first that proper definitions for each c i starting by o with every is obtained member of from u i in a separate part and then repeatedly coalescing parts xy such that either a yo or i if s is a set of sets then some ts for b u x n u y ci ci this process ultimately stops with a partition a and b for if a no longer holds for any xy ie if x n for all distinct parts xy then part x since similarly for ci z z b and b by the now let and let di i have have bi yi members members x for reduction each lemma il yi and i automaton are parameters in the statement of the lemma for each j j s yi let c c it follows from and define the definitions dags similar that for a fixed i components the c ij of the dag cl are the weakly connected and similarly for the this fact was at the end of section and is exploited at a crucial ture the end of our proof let us further define for i rl note that for each il and similarly r the for union of the ij is equal to the union of the and for odd i the union of the ij is equal to the union of the dj our may be understood thus if dags are oriented with sources at the bottom at the top and edges directed vertices along the top of then are the v and are the vertices along the bottom of a cut of a dag g is a set of vertices of g such that every path from a source to a sink includes exactly one the automaton m keeps in its finite memory a dag g and two mappings c and x r fd where g and sd c n x sc c n s and range fc and range d are of g the vertex corresponds roughly to or of course it is critical that the size of g not some constant k on any input to m otherwise m would not be a finite automaton the last steps of the proof fix k actually in our implementation it is to check the of g after it is constructed line rather than before but this is a minor detail lo procedure initialization m g a single u consisting vertex of a o fc the mapping such that domain fc x r and r vo fd the mapping such that domain fd y s and s vo repeat until no more input read a symbol if o and i is odd then begin ij x il is not a subset of domain fc then reject z k ij r unify g z if r failure r hv then reject else let f a mapping with domain f domain fc x il u x il as follows domain fc f fc ij if x il ki if k ij for each ki domain fd do g h range range fd end else w if o and if x i is not then reject i is even a subset of then domain z k ij g if r failure r z then reject else let for each ki do domain x i for each k c ij do comment ij j for each ki e domain fd do g h t range fc u range fd end else if u d c and d if the size reject of g is then larger same with than k then if f fd a function with domain u x u x accept end of procedure m before proving ed in the automaton that this procedure is as assert lemma let us make one notational convention we imagine m to read its input from right to in this way we are able to establish a natural correspondence between the input read the dag constructed and a solution to the relation in the reduction lemma proof of the automaton lemma direction let m be the procedure which results when lines and g h t range fc u range fd are replaced by g h and line the check on the size of g is omitted any input accepted by m is also accepted by m for all unification are done by matching of a dag c or n ij ij range fd with vertices in range fc so that the presence or absence or of vertices from which no member of range fc u range fd can be reached does not affect the sub sequent operation of the procedure of course m is not a finite automaton for any input word w for m let gw f f be the values of g fc fd at line the beginning has read of the main w provided repeat that loop just after m m has not rejected w now suppose that w is a word accepted by m and also lemma the conditions ad of the then there is a permutation of w of the form where l r and we have i written ms are nonnegative for the words di half of tie automaton it suffices to show for the if if u is accepted ff by m ff and g gw if cc cr x and ig y where domain and for each ig o k domain ig l ij for of the reduction lemma follows from if and the transitivity of z we prove if first assuming if then prove if the main work in proving is to set up the induction carefully after and if doing so we shall merely sketch the proof let and for let i l pi r if i j if i j lj j if ci j ij c cc r define cp cp m and q similarly from the m and j d now for il l let cp x and for il iu let qm f finally let be the largest even number yi to prove if we show if a if v im where i sml then i domain f x ii and there s an embedding p of al onto gv such that for each k c ii fb domain f fx r x is the r and sink of gv lf i i then m where i domain f x and there is an embedding p of a onto v g such that for each k c ii domain f ui x i and there is an embedding p of r v such that n g for each k ui note that if follows because of the acceptance from if condition b for i for m line and the equivalence lemma now if a for i is an of the initialization s and steps lines y since holds for il and the word i if qi is odd then is either in either case il i then transformed from il x il or qi domain into fd h x ii by removing for j qi sets qi this and replacing them by sets results in ui x as this is being done both the previous g and the dags are embedded in g and c and f are d updated appropriately for qi even the situation is simpler since then q il in either case x il il next is exactly if a for il is either qi or ii and ui x i if b for i and the induction step for if b is precisely analogous to that for if a this completes the proof of if now for the proof of if call a binary relation r acyclic if there are no al an such that and and and n we define an acyclic tion p on the symbols in z and show that as long as p does not hold of two symbols which are cent in w the symbols may be without the of the word this will make it possible to show that w can be transformed into u by transformations which preserve acceptance any partial and the order final values is acyclic of g c and any acyclic and f d rela tion may be closed to form a partial order unfortunately the relation p defined below is not a partial order and its transitive closure cannot be used in the proofs below we define a relation p recursively in four steps the relation p is the reflexive closure of p thus pcf if and only if and pa before holds only if al and we note that are both in or both in we present d the definition just for the case of two symbols in c the other case is similar then if and only if pi p p i and jl j or ii there is a j and and are both odd and such that lj fl or i there is a j and is even and such that ij r is odd and n p i is even and there is a j such that n and clearly p is acyclic on nn x r next define and pd on relations nn x pc s as follows only if and there are kl e and k ki jj such and if and that similarly for ci the relation note that any relation and pc d r elements related if and only if or is defined d are also acyclic ab are r lemma let i be odd then the only elements of n x n r which are members of x i are either are to members of lj similar fact holds for d members x il to of or a proof first suppose where k ij i z i and i is ki odd by the definition of p there are jj such that k since and k ij i j it n and ci j follows by the tion of p that and hence c thus if ki is any member of j then by the definition of pc again k il next suppose where kc j a j such that and i is odd then there k i j and if i i then k c and is x il ii definition of p there i j and i iz then by the is a j such that j ci j let k be of ij n ti j the and k as required s let p p be the reflexive closures of now call a set s c nn x cl r pc flat if and only if the elements of s are pairwise by pc if ss are then write if and only if a for every such that e s there is an cs and b for every is a s here such that ptr and c for some c s this too is acyclic closure we write p for its ow let and for e w l l let where each oi c we and let se domain fe lemma each for e se is and the same holds for d proof it contains for e html only one element s is e namely pc flat since x r now assume the lemma for el or if o c e ij for and there is nothing some even to prove i if if oe c z d then s sel e and i is odd then x il c s el and of e i ij x j x i x are is e x j s el and both moreover j e x il j no member to any member of s c x il el ij elements which are since by the to members of only l x i are either ij related to members of are no members of ij members of c x il lj x il in x il and by the assumption of or are clearly sel ­ lj for s el there pc related can be no element of s el to a member of x il se is clearly which is cs el since thus pc holds between each member of member of x il j s e x ij and lemma the symbols in w are in an order each con with p that is i then not proof suppose to the contrary that e c f but we assume that both o and o ef are in z c say o e the case in which both are in is similar d we show that there are pairs ri such that pc e f f el since it would by lemma this imply either that is sel sf is not or that pc is not acyclic case ie and if are both odd then by lines and of m x sf and t z since x c sel let and let k z be any kl be any member member of of then we have from the definition of pc that but kl sf and k e sel case ie is odd if is even then by lines and v x if f there is a of m c sf j such x and by the a that c c definition n sel and of p and n and let let kl be any member of k be any member of t ej e since then v k and kl ifc el sf case ie is even then x ie cs el and there is a j such that n o and let k be any member of case even n if if is and odd then as before let kl be selected as in and as in case there is a pair if i is f kl if is odd f if f and if is even m such that lemma suppose that cse and are not then the word is also read by m and the internal state after read ing after reading is identical we to the internal state proof if one of is in and the other is in commutativity z then the result d lemma and the fact follows that the from the symbols in the two sets are processed independently ie if a member of z c is the same mapping read then f d w that is transformed by g lines so let el and let ii be the least even numbers greater than or equal cs il to ii and respectively x i then x i cs i we want to that also x ii c s and that i i e x ii n x i so that the x i is simply embedded from ii show set into commutativity jl j and after lemma a ct el is applies read now n so if next that the il i suppose then that i domain and some member fc during the of reading x ii of enters this can happen only at v and line in n o a contradiction which case but then s i this completes the proof of if since by lemma the input w can be transformed into the input u by repeated of the kind allowed by lemma proof of the automaton lemma only if direction let q of the reduction be some particular so that solution of cr where we have defined c c cr x d ml ld d d y mm as before let m s il let and for pi j if i j if j c i c c il m similarly x and define qi for now recall from section that there are dis q copies such that l am cp cp thus of c pi cp and rl s lu and similarly for the ai for li r is a copy ij let let r ij ri of c and similarly li so that for a lj by the equivalence lemma there is a dag j and a mapping p such that unify c d ab where a is the sink of c b is the sink of d and p is an embedding of both c and d onto j extend p to a mapping v with domain vi v is a vertex of some a u i as follows for v e domain v let vj for i l gl and v c domain v l let vv for each k t nn such that v and similarly for v is like p except in being the a that is defined in addition on the sources which are not of r lj vertices and a lj of c or for i z d since they are replaced by members of ui note that v each member of u in j a of a dag is a set s of vertices such that s u t is a cut for some set t of sources of the dag if s and t are of the same dag then s precedes t if every path from a member of s to a sink of the dag contains a member of t but the distance between s and t is in this case the maximum path a member of length between a member of s and t any two st of the same dag have a and a which are also defined as follows vi v c s u t and there is no non trivial path from v to any member of in this section so as to avoid we frequently write multiple subscripts va for va vl v s t and there ia no non trivial path from any member of s ut to v a section a of a dag a is a of a such that the set of all sources of a and the set of all of a are of a a is said to be bounded by these now let s be a of j then s is an if s v is a is a lower and sink if only if for some set a of some r c is and only if for some fs c and s set s c p s v is upper and lower a source of are defined some r j similarly is since v c onto j the only upper which need not also be a lower is that consisting of the unique sink of j and every lower may be obtained from an upper r by adding some sources of j if j is a of j and c u a then let ja be the of j induced by vj u vv v is a vertex of some a f the following technical is used later lemma let j be a section of j and let be an upper of j let be the set of all r f f such that lj vv c vj for every sink v of r let be the set of all v e vj such that for some source w of some a but v ww for any vertex w of any r a let u w is a source of some r e with lj i thus each member of ­ is a source of j then is an upper t is a lower and pre proof since is an upper there is a set c f such that uv v is a sink of some a c o clearly lo c and the set i v is a source of some a c lo is a lower let ­ w is a source of an upper some and r with kl i a lower o precedes if i we are done o and f precedes g set al c such that o then o and o t yo is there is a v is a sink of some a e l let fl to f u v is a source of is a source construction some a of some may be r f j repeated and let a a with yielding l i this a sequence il of lower and a sequence w l of upper finite kt the sequence a but since must terminate with some is now define for e a of j for e sets and of vertices or of j for as follows el a subset of i is the trivial dag consisting of the single sink of j is the set containing just this one vertex even e ii el a i vv sink c v of a for each el the unions over all a el i el su el vv v is a source of r el ij with some il j el t for odd e the same with a instead of r lemma for even of and e z o el is an upper e is an upper e for each for odd e the situation e se precedes n is a section of j is e bounded for each by proof the basis cases of all these tions are straightforward now let e o be even the case for odd e is similar since is a section of j and el is an upper of j the hypotheses of lemma are satisfied i sel all the assertions but the last follow immediately clearly the set of of is and if v is a source of then v is either a source of j or a member of el a but induction in the former case v and since el precedes el and by i and ii differ only with respect v el in either case to sources s of j note that precedes e it follows e for each it need not be the they may in fact case that el cross each other from the e that fact that p precedes the sequence ultimately assume that terminates h is with even some hl the other case is let us similar then u and u h dag with vertex now let e a is a trivial v and vv e the definitions of el substituted and for that j el are not affected el moreover it are pairwise disjoint together and similarly if is now follows as well as for a the special case for which the definition of b provides is that in which some vertex not a source of j but is the e a trivial dag a in this case image a v is e under v of is a member of both e and e since v is a vertex of both j and e not fi e made here j e note for but that a no nontrivial is a member of special dags for if and need be a c e n e then every vertex in must be in the section of j bounded by se and e on the one hand and by e and on the other e is weakly connected this can happen and since a only if a is trivial next for e h let le be a listing of the members of such that if precedes r in the list j then il iz and similarly for the a j let u be the word in z that e results from replacing each r in le by the symbol if e if e is odd d each is even finally let by w l now let ge f f be the values of g fc d in m line at the beginning of the repeat loop just after u has been read then it follows from comparison of the definitions with the specification of m that is not rejected provided only that line is large enough the constant moreover k there is an embedding ee of ge onto such that e f if e is odd and e fl if e is even furthermore because for i w exactly one occur of each c and d lj ij line are met by it remains to find a k the acceptance fh and fh d large enough so each dag ge constructed the test on line ae m of course reads w k must also bound the the words ue are g ae the individual read but to show that of a bound can be set on the size of all values of it suffices to set a bound on the size of the g e g for if we let h be the of j induced by the vertices in e c be embedded onto but every value assumed be embedded into he u then not only can and ge by g as u e thus g never onto j e is read can grows larger than twice the size of the largest ge in order to bound the size of the ge it suffices to bound the length of the j e for ge can be compressed by at most a fixed ratio when embedded in j e and the width of j e bounded by the maximum width of the c and i now let ti be the length of the longest is d path in any dag in f u ie the length of the longest in any is completed by the following or d lemma the proof lemma the longest at most n t path in any has length proof first note that each path in from a vertex in el contains a vertex inj for if e source of a dag v u is a vertex v e el ac el of j e then v vw and a c el for every sink for some only if u of a and no path from a source of a to a sink of a can have length t it follows by lemma that if v el and v is not a vertex of then every path from v of length at least n contains since no nontrivial a member path could of e contain se r a source of j now to prove lemma it suffices to prove that the longest path in from a member of to a member length at most tt zn of we break the proof has into two cases a any path in from a member of el member of i e has length at most n n to a b any path in from a member of to e member of el has length at most n t a for e e both parts are trivial now let a let h be a path in vc el to a vertex w a vertex of j unless h e there would then be a j el s e is path from then trivial from a vertex v cannot since a vertex be e if v observation el is not above which is impossible a vertex of some j then by e of h starting the from v of length at most n contains a member of sel ue let h be the shortest of h starting from v and ending with a member u of e done u p since if u e then the length of it uw and we are is at most m other u e has and the part of from e length at most n n by the u to induction hypothesis rl giving for ii a total length of at most b let h be a path in from a vertex vc to a vertex e length of h w e el nl and suppose that the we derive a since e precedes e which precedes s e precedes j by the and so on e j r observation and el and so on precedes v is not e which a vertex of j above for any k then h must contain members of e tt since e en h cannot contain at intervals any member of of i e etc assume e is even the case for odd at most el e is similar let r be such that vw w for some sink w of it j but h ij and i is the largest number such that there is a r j with this property thus there must be some other sink u vertex of member of path from of r such that u j t el otherwise el u to then u el some member of vu is not a r would be a j and there is a e by the weak w to u of r ij there of length at most is a tt but also h from there are paths from u to a member of se and from a member of to w then h must contain but this is impossible at least one member since of each of the tt t en distinct s upper ee references rj parikh on pp languages jacm ms equivalence problems in a model of computation phd thesis cambridge as mit artificial lab memo ms and mn wegman linear unification proc th acm symp on theory of comp pp 